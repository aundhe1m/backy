@model Backy.Pages.DriveMetaData

@{
    var backgroundColor = Model.IsConnected ? "#198754" : "#555555";
    var usedPercentage = Model.PartitionSize > 0 ? (Model.UsedSpace * 100) / Model.PartitionSize : 0;
    var isConnected = Model.IsConnected ? "Connected" : "Disconnected";
}

<div class="card drive-card" style="width:900px;">
    <!-- Updated card-header -->
    <div class="card-header d-flex justify-content-between align-items-center"
        style="background-color:@backgroundColor; color:white;">

        <div class="d-flex align-items-center">
            <!-- Expand/Collapse button -->
            <button class="btn btn-link p-0 me-2 chevron-button" type="button" data-bs-toggle="collapse"
                data-bs-target="#driveDetails-@Model.UUID" aria-expanded="false"
                aria-controls="driveDetails-@Model.UUID">
                <img src="/icons/chevron-down-white.svg" alt="Expand Details" class="chevron-icon"
                    style="height: 24px;">
            </button>
            <img src="/icons/hdd.svg" alt="Drive Icon" style="height: 24px; margin-right: 8px;" />
            <span>@(string.IsNullOrEmpty(Model.Label) ? "Unnamed Drive" : Model.Label)</span>
        </div>
        <div class="w-50"> <!-- Added a width class for layout control -->
            <!-- Progress -->
            <div class="d-flex align-items-center">
                <span class="me-3">
                    @String.Format("{0:F2} GB", Model.UsedSpace / 1024.0 / 1024.0 / 1024.0) /
                    @String.Format("{0:F2} GB", Model.PartitionSize / 1024.0 / 1024.0 / 1024.0)
                </span>
                <div class="progress flex-grow-1 progress-with-border">
                    <div class="progress-bar" role="progressbar" style="width: @usedPercentage%"
                        aria-valuenow="@usedPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
        </div>
    </div>


    <!-- Card body -->
    <div class="card-body">
        <!-- Always visible content -->
    </div>
    <!-- Collapsible details -->
    <div class="collapse" id="driveDetails-@Model.UUID">
        <!-- Hidden details -->
        <div class="row">
            <div class="col"><strong>State:</strong> @isConnected</div>
        </div>
        <div class="row">
            <div class="col"><strong>Vendor:</strong> @Model.Vendor</div>
        </div>
        <div class="row">
            <div class="col"><strong>Model:</strong> @Model.Model</div>
        </div>
        <div class="row">
            <div class="col"><strong>Serial:</strong> @Model.Serial</div>
        </div>
        <div class="row">
            <div class="col"><strong>UUID:</strong> @Model.UUID</div>
        </div>

        <!-- Rename + Remove -->
        <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal"
            data-bs-target="#renameModal-@Model.UUID">
            @(string.IsNullOrEmpty(Model.Label) ? "Add Label" : "Rename")
        </button>

        <form method="post" asp-page-handler="RemoveDrive" asp-route-uuid="@Model.UUID"
            onsubmit="return confirmRemove();" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm" @(Model.IsConnected ? "disabled" : "")>
                Remove
            </button>
        </form>

    </div>
</div>
</div>

<!-- Modal for renaming drive label -->
<div class="modal fade" id="renameModal-@Model.UUID" tabindex="-1" aria-labelledby="renameModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="renameModalLabel">Rename Drive Label</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" asp-page-handler="RenameDriveLabel" asp-route-uuid="@Model.UUID">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="driveLabelInput" class="form-label">New Label</label>
                        <input type="text" class="form-control" id="driveLabelInput" name="newLabel"
                            placeholder="Enter new label" value="@Model.Label" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
