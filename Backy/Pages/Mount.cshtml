@page
@using System.Text.Json
@model Backy.Pages.MountModel
@{
    ViewData["Title"] = "Mount Manager";
}

<div class="container">
    <h1 class="display-4 text-center my-5">Mount Manager</h1>

    @if (Model.Drives.Count == 0)
    {
        <div class="alert alert-warning text-center">
            No drives found.
        </div>
    }
    else
    {
        <script>
            const drivesData = @Html.Raw(JsonSerializer.Serialize(Model.Drives));
        </script>

        <script src="/js/Index.js"></script>

        @foreach (var drive in Model.Drives)
        {
            <div class="card mb-3 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>
                        <i class="fas fa-hdd"></i> @drive.Name
                        <span class="badge badge-secondary text-dark">
                            <script>
                                document.write(formatSize(@drive.Size));
                            </script>
                        </span>
                    </h4>
                    <!-- Swapped position -->
                    <div>
                        <form method="post" asp-page-handler="CreatePartition" asp-route-driveName="@drive.Name"
                            class="d-inline-block">
                            <button type="submit" class="btn btn-outline-primary">Create Partition</button>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Serial, Vendor, Model -->
                    <div class="mb-2 text-muted">
                        <strong>Serial:</strong> @drive.Serial |
                        <strong>Vendor:</strong> @drive.Vendor |
                        <strong>Model:</strong> @drive.Model
                    </div>

                    @if (drive.Partitions.Count > 0)
                    {
                        @foreach (var partition in drive.Partitions)
                        {

                            string backgroundColor = "#555555"; // Default color if not mounted
                            if (partition.MountPoint != "Not Mounted")
                            {
                                if (string.IsNullOrEmpty(partition.Label))
                                {
                                    backgroundColor = "#198754"; // Mounted but no label
                                }
                                else
                                {
                                    backgroundColor = "#0d6efd"; // Mounted and has label
                                }
                            }


                            <div class="card mt-3">
                                <div class="card-header d-flex justify-content-between align-items-center"
                                    style="background-color: @backgroundColor; color: white;">
                                    <!-- Label -->
                                    <span class="text" style="font-weight: bold; color: white;">@partition.Label</span>

                                    <!-- Button Group -->
                                    <div class="btn-group">
                                        <!-- Mount/Unmount Button -->
                                        @if (partition.MountPoint != "Not Mounted")
                                        {
                                            <form method="post" asp-page-handler="UnmountPartition"
                                                asp-route-partitionName="@partition.Name" asp-route-uuid="@partition.UUID"
                                                class="d-inline-block">
                                                <button type="submit" class="btn btn-warning">Unmount</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <form method="post" asp-page-handler="MountPartition" asp-route-partitionName="@partition.Name"
                                                asp-route-uuid="@partition.UUID" class="d-inline-block">
                                                <button type="submit" class="btn btn-success">Mount</button>
                                            </form>
                                        }

                                        <!-- Manage Dropdown -->
                                        <div class="dropdown d-inline-block">
                                            <button class="btn btn-secondary dropdown-toggle" type="button"
                                                id="dropdownMenuButton-@partition.Name" data-bs-toggle="dropdown" aria-expanded="false">
                                                Manage
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end"
                                                aria-labelledby="dropdownMenuButton-@partition.Name">
                                                <li>
                                                    <form method="post" asp-page-handler="FormatPartition"
                                                        asp-route-partitionName="@partition.Name">
                                                        <button type="submit" class="dropdown-item">Format</button>
                                                    </form>
                                                </li>
                                                <li>
                                                    <form method="post" asp-page-handler="RemovePartition"
                                                        asp-route-partitionName="@partition.Name">
                                                        <button type="submit" class="dropdown-item">Delete</button>
                                                    </form>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row row-cols-3">
                                        <!-- "Partition:" -->
                                        <div class="col">
                                            <strong>Partition:</strong> @partition.Name
                                        </div>
                                        <!-- "Mountpoint:" -->
                                        <div class="col-6">
                                            <strong>Mountpoint:</strong>
                                            <span class="truncate" data-bs-toggle="tooltip"
                                                title="@partition.MountPoint">@partition.MountPoint</span>
                                        </div>
                                        <!-- "Filesystem:" -->
                                        <div class="col">
                                            <strong>Filesystem:</strong> @partition.Fstype
                                        </div>
                                        <!-- "UUID:" -->
                                        <div class="col-6">
                                            <strong>UUID:</strong>
                                            <span class="truncate" data-bs-toggle="tooltip"
                                                title="@partition.UUID">@partition.UUID</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        }
    }
</div>

<!-- Link to external CSS file -->
<link rel="stylesheet" href="/css/Index.css">
