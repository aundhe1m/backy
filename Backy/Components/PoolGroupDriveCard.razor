@using Backy.Models
@using Microsoft.Extensions.Logging
@using Blazored.Toast.Services
@inject ILogger<PoolGroupDriveCard> Logger
@inject IToastService ToastService
@inject NavigationManager Navigation

<div class="card drive-card mb-3">
    <!-- Card Header -->
    <div class="card-header d-flex justify-content-between align-items-center"
        style="background-color:@HeaderBackgroundColor; color:black;">
        <div class="d-flex align-items-center">
            <!-- Expand/Collapse button -->
            <button class="btn btn-link p-0 me-2 chevron-button" @onclick="ToggleDetails">
                <img src="/icons/chevron-down.svg" alt="Expand Details" class="chevron-icon" style="height: 24px;" />
            </button>
            <!-- Drive Icon -->
            <img src="/icons/hdd.svg" alt="Drive Icon" style="height: 24px; margin-right: 8px;" />
            <span>@Model.GroupLabel</span>
        </div>
        <!-- Force Add Button -->
        <div class="btn-group">
            <button class="btn btn-secondary" @onclick="UnmountPool">Unmount</button>
            <button class="btn btn-danger" @onclick="RemovePoolGroup">Remove</button>
            <button class="btn btn-primary" @onclick="MountPool">Mount</button>
            <button class="btn btn-info" @onclick="RenamePoolGroup">Rename</button>
        </div>
    </div>

    <!-- Drive Details -->
    @if (IsDetailsVisible)
    {
        <div class="card-body">
            <!-- Drive Details Table -->
            <div class="table-responsive">
                <table class="table table-striped">
                    <tbody>
                        <tr>
                            <th>State</th>
                            <td>@IsConnected</td>
                        </tr>
                        <tr>
                            <th>Vendor</th>
                            <td>@Model.Vendor</td>
                        </tr>
                        <tr>
                            <th>Model</th>
                            <td>@Model.Model</td>
                        </tr>
                        <tr>
                            <th>Serial</th>
                            <td>@Model.Serial</td>
                        </tr>
                        <tr>
                            <th>Size</th>
                            <td>@FormatSize(Model.Size)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public PoolGroup Model { get; set; }

    [Parameter]
    public EventCallback<PoolGroup> OnUnmountPool { get; set; }

    [Parameter]
    public EventCallback<PoolGroup> OnRemovePoolGroup { get; set; }

    [Parameter]
    public EventCallback<PoolGroup> OnMountPool { get; set; }

    [Parameter]
    public EventCallback<PoolGroup> OnRenamePoolGroup { get; set; }

    private bool IsDetailsVisible { get; set; } = false;

    private void ToggleDetails()
    {
        IsDetailsVisible = !IsDetailsVisible;
    }

    private async Task UnmountPool()
    {
        await OnUnmountPool.InvokeAsync(Model);
    }

    private async Task RemovePoolGroup()
    {
        await OnRemovePoolGroup.InvokeAsync(Model);
    }

    private async Task MountPool()
    {
        await OnMountPool.InvokeAsync(Model);
    }

    private async Task RenamePoolGroup()
    {
        await OnRenamePoolGroup.InvokeAsync(Model);
    }
}